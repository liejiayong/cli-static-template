<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>登录</title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link rel="stylesheet" type="text/css" href="style/css/register-login.css">
</head>
</head>
<body>
<style>
.cent-box{
    height: 274px;
    margin-top: -137px;
}
</style>
<div id="box"></div>
<div class="cent-box">
	<div class="cent-box-header">
		<div style="text-align: right;"><a style="text-decoration: underline;color: #7b7b7b;" href="index.html">返回首页</a></div>
	</div>

	<div class="cont-main clearfix">
		<div class="index-tab">
			<div class="index-slide-nav">
				<a href="javascript:;" class="active">登录</a>
				<a href="reg.html">注册</a>
				<div class="slide-bar"></div>				
			</div>
		</div>
    	<form action='/t/5ea843c245763/ajaxlogin_v2' method="post" id="loginbox" onsubmit=" return index.submit()">
    		<input type="hidden" name="token" value="291afc6b0c6d3311991696ca26490b2f" />
        	<input type="hidden" name="type" value="1">
        	<input type="hidden" name="referer" value="http://www.tanwan.cn/t/5ea843c245763/login_v2">
			<div class="login form">
				<div class="group">
					<div class="group-ipt username">
						<input type="text" name="username" id="username" autocomplete="off" class="ipt" placeholder="输入您的用户名" required>
					</div>
					<div class="group-ipt paswrd">
						<input type="password" name="paswrd" id="paswrd" class="ipt" placeholder="输入您的登录密码" required>
					</div>
				</div>
			</div>

			<div class="button">
				<input type="submit" class="login-btn register-btn" id="button" value="登录" />
			</div>
		</form>
	</div>
</div>

<script src='style/js/particles.js' type="text/javascript"></script>
<script src='style/js/background.js' type="text/javascript"></script>
<script src='style/js/jquery.min.js' type="text/javascript"></script>
<script src="style/js/layer.min.js"></script>
<link href="style/css/layer.min.css" rel="stylesheet">
<script>
var keywords = '';
var index = {
    init : function(){},
    submit : function(){
        $.post('/t/5ea843c245763/ajaxlogin_v2',$('#loginbox').serialize(),function(data){
            console.log(data);
            // return false;
            layer.msg(data.msg);
            if(data.state == 200){
                // 登录成功
                setTimeout(function(){
					window.location.href=data.referer;
				},1000);
            }else{
            	$('.imgcode').attr('src','/home/Member/verify');
				$('input[name="captcha"]').val('');
            }
        });
        return false;
    },
    load : function(){
        this.blur();
    }
}

$(function(){
});

</script>
<input type="hidden" name="web_titles" value="登录">
<script src="style/js/layer.js"></script>
<link href="style/css/layer.css" rel="stylesheet">
<!-- 用于收集客户端IP及关键字清除 start -->
<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
<script type="text/javascript">
var mBrower_id;
var mBrower_time = 0;
// 过滤关键字
var j_keywords = '';

var keywords_v2 = {
    filterAction : function(searchWord){
        var reg = new RegExp(searchWord, 'g');
        function replaceNode(node){
            node.childNodes.forEach(function(v){
                if(v.nodeName === 'SCRIPT')
                    return; //排除<script>标签
                if(!v.hasChildNodes()){
                    if(reg.test(v.textContent))
                        v.textContent = v.textContent.replace(reg, '***');
                    return;
                }
                replaceNode(v);
            });
        }
        replaceNode(document.body);
    },
    filterNow : function(){
        [['空调', '**'],['好', '不好'], ['他','你'],['女','男']].forEach(function(item){
            this.filterAction(item[0], item[1]);
        });
    },
    getKeyWords : function(){
        $.ajax({
            type: 'GET',
            url:'/homeadmin/member_keywords/getAllKeyWords?1589191929',
            dataType: 'json',
            success: function( data ) {
                // console.log(data);
                j_keywords = '|'+data+'|';
                keywords_v2.filterAction(data);
                // console.log(j_keywords);
            }
        });
    },
    keyup : function(){
        $('body').on('keyup','input',function(){
            var that = $(this);
            if(j_keywords.indexOf('|'+that.val()+'|') > -1){
                alert('用户名不合法，请重新输入');
                that.val('');
                return false;
            }
        });
    },
    sendBrower : function(){
        var addr_ip = returnCitySN['cip'];
        // var addr_ip = returnCitySN["cip"];
        var addr_city = returnCitySN["cname"];
        // 这里的mem_name是前端客户登录后的用户名
        var mem_name = '';
        var url = window.location.href;
        var url_title = $('input[name="web_titles"]').val();
        var order_num = '5ea843c245763';
        var useragent = navigator.userAgent;
        var referer = '该功能维护中';
        $.post('/homeadmin/member_browse/ajaxadd', { addr_ip: addr_ip, addr_city: addr_city ,mem_name:mem_name== ''?'游客':mem_name,url:url,url_title:url_title,order_num:order_num,useragent:useragent,referer:referer}, function(data) {
            console.log(data);
            if(data.state == 200){
                mBrower_id = data.data;
            }
        });
    },
    timePlus : function(){
        setTimeout(function(){
            mBrower_time++;
            keywords_v2.timePlus();
        },1000);
    },
    getStepTime : function(){
        setTimeout(function(){
            $.get('/homeadmin/member_browse/ajax_update_statetime/id/'+mBrower_id+'/time/'+mBrower_time,function(data){});
            keywords_v2.getStepTime();
        },2000);
    },
    load : function(){
        this.getKeyWords();
        this.sendBrower();
        this.getStepTime();
        this.keyup();
        this.timePlus();
    }
};

var chkBrowerVersion = {
    init : function(){
        this.chk();
    },
    browerVersion : function(){
        var u = navigator.userAgent, app = navigator.appVersion;
        return {
            trident: u.indexOf('Trident') > -1
        };
    },
    getUserAgent :function(){
        return navigator.userAgent
    },
    chk : function(){
        var bro = this.browerVersion();
        if(bro.trident){
            $('body').prepend('<style>#userBrowerVersion{background: #eee;padding: 15px 0;display:none;}#userBrowerVersion .userBrowerVersion-w{width: 750px;margin: 0 auto;position: relative;}#userBrowerVersion .userBrowerVersion-w .close{color: #282828;position: absolute;right: 0;top: 0;font-size: 30px;font-weight: 100;}#userBrowerVersion .userBrowerVersion-w p{color: #282828;font-size: 12px;line-height: 18px;}#userBrowerVersion .userBrowerVersion-w p a{text-decoration: underline;color: #282828;font-size: 12px;line-height: 18px;margin-right: 13px;}</style><div id="userBrowerVersion"><div class="userBrowerVersion-w"><p>检测到您当前使用的是IE内核的浏览器，为获得更好的浏览体验，建议您使用以下浏览器浏览页面：</p><p><a href="https://www.google.cn/intl/zh-CN/chrome/" target="_blank">谷歌浏览器 >></a><a href="https://www.firefox.com.cn/" target="_blank">火狐浏览器 >></a><a href="https://www.opera.com/zh-cn" target="_blank">Opera浏览器 >></a></p><p>或使用360浏览器、搜狗浏览器的【极速模式】.</p><a href="javascript:;" class="close">X</a></div></div>');
            $('#userBrowerVersion').show(200);
        }
    },
    click : function(){
        $('body').on('click','#userBrowerVersion .close',function(){
            $('#userBrowerVersion').hide(200);
        });
    },
    load : function(){
        this.init();
        this.click();
    }
};
$(function(){
    chkBrowerVersion.load();
    keywords_v2.load();
});
// keywords_v2.load();
</script>
</body>
</html>
