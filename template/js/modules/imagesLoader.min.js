// JavaScript Document
/**
 * 图片预加载
 * @version	0.0.1
 * @Date    2022-12-31
 * @author	JyLie
 * @param	{Array}	    要预加载的图片数组
 * @param	{Function}	加载过程
 * @param	{Function}	加载完毕 

 * @example 
    var imagesLoader=new ImagesLoader({baseURL:'https://img1.baidu.com/it/'});
    imagesLoader.loadImages(['u=1949978719,443502016&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500','u=3099359318,1241670389&fm=253&fmt=auto&app=138&f=JPEG?w=809&h=500'], function(precent) {
      console.log(precent,this)
    }, function() {
      console.log('finish',this)
    });
    imagesLoader.loadImage('u=1949978719,443502016&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500'function() {
      console.log('finish',this)
    });
    imagesLoader.get('name')
 */
/* prettier-ignore */!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).ImagesLoader=factory()}(this,(function(){"use strict";function isFunction(obj){return"[object Function]"===Object.prototype.toString.call(obj)}return function(){function ImagesLoader(opts){var obj;this.onProcess=function(){},this.onComplete=function(){},obj=opts,opts="[object Object]"===Object.prototype.toString.call(obj)?opts:{},this.baseURL=opts.baseURL||"",this.ext=opts.ext||"(jpg|jpeg|png|gif|webp)",this.scale="number"==typeof opts.scale?opts.scale:1,this.isAppend="boolean"!=typeof opts.isAppend||opts.isAppend,this.cache="boolean"==typeof opts.cache&&opts.cache,this.urls=[],this.temps=[],this.maps={},this.tempLength=0,this.percent=0}return ImagesLoader.prototype._load_=function(){var _this=this,url=this.temps.shift();void 0!==url&&this.loadImage(url,(function(obj){obj&&(_this.maps[obj.name]=obj);var percent=(_this.tempLength-_this.temps.length)/_this.tempLength;percent=(percent=Math.floor(100*percent))>=100?100:percent,_this.percent=percent,isFunction(_this.onProcess)&&_this.onProcess.call(_this,percent),_this.temps.length?_this._load_():isFunction(_this.onComplete)&&_this.onComplete.call(_this,_this.maps)}))},ImagesLoader.prototype.loadImages=function(urls,onProcess,onComplete){this.temps=urls||[],this.tempLength=urls.length,isFunction(onProcess)&&(this.onProcess=onProcess),isFunction(onComplete)&&(this.onComplete=onComplete),this._load_()},ImagesLoader.prototype.loadImage=function(filename,onComplete){var _this=this,baseURL=this.baseURL,img=new Image,url=baseURL+filename+(this.cache?"?t="+Date.now():""),fid=this.normalizeName(filename)||"img"+Date.now();img.id=fid,img.src=url,img.setAttribute("crossOrigin","Anonymous"),img.onload=function(){var name=fid,width=img.width*_this.scale,height=img.height*_this.scale;img.width=width,img.height=height,_this.isAppend&&(img.style.cssText="visibility: hidden; opacity:0.2; width: 1px; height: 1px;pointer-events: none; position: absolute;",document.body.appendChild(img)),isFunction(onComplete)&&onComplete({name:name,url:url,element:img,width:width,height:height,scale:_this.scale}),img.onload=null},img.onerror=function(){isFunction(onComplete)&&onComplete(null),img.onerror=null}},ImagesLoader.prototype.get=function(name){return this.maps[name]},ImagesLoader.prototype.normalizeName=function(url){void 0===url&&(url="");var pattern=new RegExp("[\\/]*([-\\.\\w]*)\\."+this.ext+"$"),name=String(url).match(pattern)||"";return name=name?name[1]:"",name=this._toCamel(name)},ImagesLoader.prototype._toCamel=function(str){return void 0===str&&(str=""),str.replace(/-(\w)/g,(function(m,k){return k?k.toUpperCase():""}))},ImagesLoader}()}));
//# sourceMappingURL=imagesloader.global.js.map

